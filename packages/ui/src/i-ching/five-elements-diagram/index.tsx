'use client'

import { cn } from '@repo/stephen-v2-utils'
import type { SVGMotionProps, Variants } from 'motion/react'
import { motion, useReducedMotion } from 'motion/react'
import { useTheme } from 'next-themes'
import { useEffect, useState } from 'react'

import { GradientTracing } from './gradient-tracing'

const draw: Variants = {
	initial: {
		pathLength: 0,
	},
	animate: {
		pathLength: 1,
		transition: {
			ease: 'easeOut',
			duration: 1.5,
			staggerChildren: 0.5,
			// repeat: Infinity,
		},
	},
}

function FiveElementsDiagram({ className, ...props }: SVGMotionProps<SVGSVGElement>) {
	const reduce = useReducedMotion()
	const { theme } = useTheme()

	const [loaded, setLoaded] = useState(false)
	const [iteration, setIteration] = useState(0)

	useEffect(() => {
		setLoaded(true)
	}, [])

	if (!loaded) return null

	return (
		<>
			<motion.svg
				width="430"
				height="425"
				viewBox="0 0 430 425"
				fill="none"
				xmlns="http://www.w3.org/2000/svg"
				className={cn('resize-x h-auto cursor-pointer', className)}
				variants={draw}
				initial={reduce ? false : 'initial'}
				whileInView={reduce ? undefined : 'animate'}
				viewport={{ once: false, amount: 0.9 }}
				key={iteration}
				onClick={() => setIteration(iteration + 1)}
				{...props}
			>
				{/* big circle */}
				<CircleGradientTracing
					cx={213}
					cy={225}
					r={199.5}
					strokeWidth={1.5}
					baseColor={theme === 'dark' ? '#43434378' : '#3D3D3D78'}
					gradientColors={['#06b6d4', '#06b6d4', '#06b6d4']}
					duration={4}
				/>

				{/* star lines */}
				{/* kim => mộc */}
				<GradientTracing
					from="left-to-right"
					width={430}
					height={425}
					path="M22.001 161.504 L400.001 161.504"
					gradientColors={['#ef4444', '#ef4444', '#ef4444']}
				/>
				<motion.path
					d="M22.001 161.504 L400.001 161.504"
					stroke={theme === 'dark' ? '#43434378' : '#3D3D3D78'}
					variants={draw}
				/>
				{/* mộc => thổ */}
				<GradientTracing
					from="right-to-left"
					width={430}
					height={425}
					path="M400.002 161.504L94.2972 385.407"
					gradientColors={['#ef4444', '#ef4444', '#ef4444']}
				/>
				<motion.path
					d="M400.002 161.504L94.2972 385.407"
					stroke={theme === 'dark' ? '#43434378' : '#3D3D3D78'}
					variants={draw}
				/>
				{/* thổ => thủy */}
				<GradientTracing
					from="left-to-right"
					width={430}
					height={425}
					path="M94.6358 385.157L210.659 25.0041"
					gradientColors={['#ef4444', '#ef4444', '#ef4444']}
				/>
				<motion.path
					d="M94.6358 385.157L210.659 25.0041"
					stroke={theme === 'dark' ? '#43434378' : '#3D3D3D78'}
					variants={draw}
				/>
				{/* thủy => hỏa */}
				<GradientTracing
					from="left-to-right"
					width={430}
					height={425}
					path="M211.502 25.0041L327.524 385.157"
					gradientColors={['#ef4444', '#ef4444', '#ef4444']}
				/>
				<motion.path
					d="M211.502 25.0041L327.524 385.157"
					stroke={theme === 'dark' ? '#43434378' : '#3D3D3D78'}
					variants={draw}
				/>
				{/* hỏa => kim */}
				<GradientTracing
					from="right-to-left"
					width={430}
					height={425}
					path="M327.501 385.003C208 297.916 141.793 248.684 22.2929 161.597"
					gradientColors={['#ef4444', '#ef4444', '#ef4444']}
				/>
				<motion.path
					d="M327.501 385.003C208 297.916 141.793 248.684 22.2929 161.597"
					stroke={theme === 'dark' ? '#43434378' : '#3D3D3D78'}
					variants={draw}
				/>
				<motion.circle
					cx="211"
					cy="25"
					r="24.5"
					fill="#262626"
					stroke={theme === 'dark' ? '#43434378' : '#3D3D3D78'}
				/>
				<motion.path
					d="M195.157 21.4688V20.0469H203.073V21.4688H200.038V30H198.199V21.4688H195.157ZM204.16 30V19.5205H205.938V23.7246C206.165 23.4102 206.462 23.1527 206.826 22.9521C207.195 22.7516 207.633 22.6514 208.139 22.6514C208.813 22.6514 209.367 22.8656 209.8 23.2939C210.237 23.7178 210.456 24.4128 210.456 25.3789V30H208.679V25.4541C208.679 24.9482 208.565 24.5882 208.337 24.374C208.114 24.1598 207.806 24.0527 207.414 24.0527C207.068 24.0527 206.769 24.1484 206.519 24.3398C206.268 24.5267 206.074 24.7865 205.938 25.1191V30H204.16ZM212.213 27.2793V22.7949H213.99V27.3271C213.99 27.8512 214.1 28.2181 214.318 28.4277C214.542 28.6374 214.847 28.7422 215.234 28.7422C215.576 28.7422 215.879 28.6465 216.144 28.4551C216.412 28.2591 216.618 28.0153 216.759 27.7236V22.7949H218.536V30H216.868L216.82 29.1523H216.779C216.551 29.4577 216.253 29.6992 215.884 29.877C215.515 30.0501 215.102 30.1367 214.646 30.1367C213.926 30.1367 213.341 29.918 212.89 29.4805C212.438 29.043 212.213 28.3092 212.213 27.2793ZM214.92 21.6602V21.3867C214.92 21.1087 214.993 20.8854 215.139 20.7168C215.285 20.5482 215.524 20.4411 215.856 20.3955C216.084 20.3636 216.239 20.3158 216.321 20.252C216.403 20.1836 216.444 20.0651 216.444 19.8965C216.444 19.737 216.383 19.6208 216.26 19.5479C216.141 19.4749 215.973 19.4385 215.754 19.4385C215.49 19.4385 215.225 19.4772 214.961 19.5547C214.701 19.6322 214.546 19.6891 214.496 19.7256L214.079 18.7754C214.248 18.6888 214.514 18.5977 214.879 18.502C215.243 18.4062 215.619 18.3584 216.007 18.3584C216.576 18.3584 217.009 18.4906 217.306 18.7549C217.602 19.0192 217.75 19.377 217.75 19.8281C217.75 20.2975 217.597 20.6712 217.292 20.9492C216.991 21.2272 216.517 21.3913 215.87 21.4414V21.6602H214.92ZM220.033 32.8438L220.047 31.4834C220.161 31.5199 220.288 31.5472 220.43 31.5654C220.571 31.5882 220.708 31.5996 220.84 31.5996C221.15 31.5996 221.421 31.4948 221.653 31.2852C221.886 31.0755 222.102 30.638 222.303 29.9727L222.255 29.9658L219.493 22.7949H221.277L222.822 27.1631C222.882 27.3408 222.929 27.5049 222.966 27.6553C223.007 27.8057 223.043 27.9538 223.075 28.0996H223.116C223.153 27.9538 223.189 27.8057 223.226 27.6553C223.267 27.5049 223.317 27.3408 223.376 27.1631L224.839 22.7949H226.459L223.513 30.8887C223.267 31.5677 222.932 32.085 222.508 32.4404C222.084 32.8005 221.569 32.9805 220.963 32.9805C220.767 32.9805 220.594 32.9691 220.443 32.9463C220.298 32.9235 220.161 32.8893 220.033 32.8438Z"
					fill="#FAFAFA"
					variants={draw}
				/>
				<motion.circle
					cx="405"
					cy="160"
					r="24.5"
					fill="#A3E635"
					stroke={theme === 'dark' ? '#43434378' : '#3D3D3D78'}
				/>
				<motion.path
					d="M391.094 165V155.047H393.445L396.016 161.842C396.07 161.988 396.118 162.131 396.159 162.272C396.205 162.414 396.243 162.562 396.275 162.717H396.323C396.355 162.562 396.392 162.414 396.433 162.272C396.478 162.131 396.528 161.988 396.583 161.842L399.16 155.047H401.539V165H399.728V158.369C399.728 158.223 399.73 158.062 399.734 157.884C399.743 157.701 399.757 157.537 399.775 157.392H399.721C399.693 157.537 399.655 157.701 399.604 157.884C399.559 158.062 399.509 158.223 399.454 158.369L396.952 165H395.428L392.933 158.369C392.878 158.223 392.826 158.062 392.775 157.884C392.73 157.701 392.693 157.537 392.666 157.392H392.611C392.63 157.537 392.641 157.701 392.646 157.884C392.65 158.062 392.652 158.223 392.652 158.369V165H391.094ZM403.159 161.507V161.288C403.159 160.167 403.49 159.271 404.15 158.602C404.816 157.927 405.686 157.59 406.762 157.59C407.842 157.59 408.712 157.927 409.373 158.602C410.038 159.271 410.371 160.167 410.371 161.288V161.507C410.371 162.623 410.038 163.519 409.373 164.193C408.712 164.868 407.842 165.205 406.762 165.205C405.686 165.205 404.816 164.868 404.15 164.193C403.49 163.519 403.159 162.623 403.159 161.507ZM404.978 161.213V161.582C404.978 162.275 405.13 162.824 405.436 163.229C405.741 163.631 406.183 163.831 406.762 163.831C407.34 163.831 407.783 163.631 408.088 163.229C408.393 162.824 408.546 162.275 408.546 161.582V161.213C408.546 160.516 408.391 159.966 408.081 159.565C407.776 159.164 407.336 158.964 406.762 158.964C406.192 158.964 405.752 159.164 405.442 159.565C405.132 159.966 404.978 160.516 404.978 161.213ZM407.22 154.268L409.113 156.66H407.78L406.762 155.58L405.75 156.66H404.424L406.304 154.268H407.22ZM405.757 167.085C405.757 166.821 405.843 166.597 406.017 166.415C406.19 166.237 406.438 166.148 406.762 166.148C407.085 166.148 407.334 166.237 407.507 166.415C407.685 166.597 407.773 166.821 407.773 167.085C407.773 167.349 407.685 167.57 407.507 167.748C407.334 167.93 407.085 168.021 406.762 168.021C406.438 168.021 406.19 167.93 406.017 167.748C405.843 167.57 405.757 167.349 405.757 167.085ZM411.431 161.507V161.288C411.431 160.167 411.752 159.271 412.395 158.602C413.037 157.927 413.898 157.59 414.979 157.59C415.995 157.59 416.77 157.85 417.303 158.369C417.836 158.889 418.114 159.495 418.137 160.188L418.144 160.276H416.414V160.208C416.414 159.857 416.296 159.559 416.059 159.312C415.826 159.062 415.464 158.937 414.972 158.937C414.393 158.937 413.96 159.148 413.673 159.572C413.39 159.992 413.249 160.538 413.249 161.213V161.582C413.249 162.252 413.388 162.799 413.666 163.223C413.949 163.646 414.382 163.858 414.965 163.858C415.489 163.858 415.86 163.731 416.079 163.476C416.302 163.216 416.414 162.917 416.414 162.58V162.519H418.144V162.587C418.144 163.275 417.87 163.883 417.323 164.412C416.781 164.941 415.999 165.205 414.979 165.205C413.898 165.205 413.037 164.868 412.395 164.193C411.752 163.519 411.431 162.623 411.431 161.507Z"
					fill="black"
					variants={draw}
				/>
				<motion.circle
					cx="25"
					cy="160"
					r="24.5"
					fill="white"
					stroke={theme === 'dark' ? '#43434378' : '#3D3D3D78'}
				/>
				<motion.path
					d="M13.0938 165V155.047H14.9258V159.415L18.8291 155.047H20.873L14.9258 161.589V165H13.0938ZM19.082 165L15.459 160.085L16.6348 158.779L21.3174 165H19.082ZM22.042 165V157.795H23.8262V165H22.042ZM21.8779 155.737C21.8779 155.459 21.9691 155.227 22.1514 155.04C22.3337 154.853 22.5957 154.76 22.9375 154.76C23.2747 154.76 23.5345 154.853 23.7168 155.04C23.9036 155.227 23.9971 155.459 23.9971 155.737C23.9971 156.015 23.9036 156.25 23.7168 156.441C23.5345 156.628 23.2725 156.722 22.9307 156.722C22.5934 156.722 22.3337 156.628 22.1514 156.441C21.9691 156.25 21.8779 156.015 21.8779 155.737ZM25.7266 165V157.795H27.3945L27.4424 158.649H27.4834C27.7067 158.335 27.9984 158.091 28.3584 157.918C28.7184 157.745 29.1081 157.658 29.5273 157.658C30.0241 157.658 30.4548 157.761 30.8193 157.966C31.1839 158.166 31.4528 158.474 31.626 158.889H31.6602C31.9199 158.474 32.2503 158.166 32.6514 157.966C33.057 157.761 33.4945 157.658 33.9639 157.658C34.6976 157.658 35.2809 157.879 35.7139 158.321C36.1514 158.759 36.3701 159.493 36.3701 160.522V165H34.5928V160.434C34.5928 159.955 34.4925 159.606 34.292 159.388C34.0915 159.164 33.7975 159.053 33.4102 159.053C33.0775 159.048 32.7858 159.139 32.5352 159.326C32.2845 159.513 32.0863 159.766 31.9404 160.085V165H30.1562V160.447C30.1562 159.96 30.0537 159.606 29.8486 159.388C29.6481 159.164 29.3542 159.053 28.9668 159.053C28.6296 159.053 28.3379 159.144 28.0918 159.326C27.8457 159.508 27.6497 159.761 27.5039 160.085V165H25.7266Z"
					fill="black"
					variants={draw}
				/>
				<motion.circle
					cx="98"
					cy="382"
					r="24.5"
					fill="#FDE047"
					stroke={theme === 'dark' ? '#43434378' : '#3D3D3D78'}
				/>
				<motion.path
					d="M85.1572 378.469V377.047H93.0732V378.469H90.0381V387H88.1992V378.469H85.1572ZM94.1602 387V376.521H95.9375V380.725C96.1654 380.41 96.4616 380.153 96.8262 379.952C97.1953 379.752 97.6328 379.651 98.1387 379.651C98.8132 379.651 99.3669 379.866 99.7998 380.294C100.237 380.718 100.456 381.413 100.456 382.379V387H98.6787V382.454C98.6787 381.948 98.5648 381.588 98.3369 381.374C98.1136 381.16 97.806 381.053 97.4141 381.053C97.0677 381.053 96.7692 381.148 96.5186 381.34C96.2679 381.527 96.0742 381.786 95.9375 382.119V387H94.1602ZM101.878 383.507V383.288C101.878 382.167 102.208 381.271 102.869 380.602C103.535 379.927 104.405 379.59 105.48 379.59C106.561 379.59 107.431 379.927 108.092 380.602C108.757 381.271 109.09 382.167 109.09 383.288V383.507C109.09 384.623 108.757 385.519 108.092 386.193C107.431 386.868 106.561 387.205 105.48 387.205C104.405 387.205 103.535 386.868 102.869 386.193C102.208 385.519 101.878 384.623 101.878 383.507ZM103.696 383.213V383.582C103.696 384.275 103.849 384.824 104.154 385.229C104.46 385.631 104.902 385.831 105.48 385.831C106.059 385.831 106.501 385.631 106.807 385.229C107.112 384.824 107.265 384.275 107.265 383.582V383.213C107.265 382.516 107.11 381.966 106.8 381.565C106.494 381.164 106.055 380.964 105.48 380.964C104.911 380.964 104.471 381.164 104.161 381.565C103.851 381.966 103.696 382.516 103.696 383.213ZM105.932 376.268L107.832 378.66H106.492L105.474 377.58L104.462 378.66H103.143L105.016 376.268H105.932ZM107.224 376.951V376.678C107.224 376.395 107.297 376.17 107.442 376.001C107.588 375.832 107.827 375.728 108.16 375.687C108.388 375.655 108.543 375.607 108.625 375.543C108.707 375.475 108.748 375.356 108.748 375.188C108.748 375.028 108.687 374.912 108.563 374.839C108.445 374.766 108.276 374.729 108.058 374.729C107.793 374.729 107.529 374.768 107.265 374.846C107.005 374.923 106.85 374.98 106.8 375.017L106.383 374.066C106.551 373.975 106.818 373.882 107.183 373.786C107.547 373.69 107.923 373.643 108.311 373.643C108.88 373.643 109.313 373.777 109.609 374.046C109.906 374.31 110.054 374.666 110.054 375.112C110.054 375.586 109.901 375.962 109.596 376.24C109.295 376.518 108.821 376.682 108.174 376.732V376.951H107.224Z"
					fill="black"
					variants={draw}
				/>
				<motion.circle
					cx="332"
					cy="382"
					r="24.5"
					fill="#EF4444"
					stroke={theme === 'dark' ? '#43434378' : '#3D3D3D78'}
				/>
				<motion.path
					d="M319.094 387V377.047H320.926V381.155H325.273V377.047H327.105V387H325.273V382.584H320.926V387H319.094ZM328.726 383.507V383.288C328.726 382.167 329.056 381.271 329.717 380.602C330.382 379.927 331.253 379.59 332.328 379.59C333.408 379.59 334.279 379.927 334.939 380.602C335.605 381.271 335.938 382.167 335.938 383.288V383.507C335.938 384.623 335.605 385.519 334.939 386.193C334.279 386.868 333.408 387.205 332.328 387.205C331.253 387.205 330.382 386.868 329.717 386.193C329.056 385.519 328.726 384.623 328.726 383.507ZM330.544 383.213V383.582C330.544 384.275 330.697 384.824 331.002 385.229C331.307 385.631 331.749 385.831 332.328 385.831C332.907 385.831 333.349 385.631 333.654 385.229C333.96 384.824 334.112 384.275 334.112 383.582V383.213C334.112 382.516 333.957 381.966 333.647 381.565C333.342 381.164 332.902 380.964 332.328 380.964C331.758 380.964 331.319 381.164 331.009 381.565C330.699 381.966 330.544 382.516 330.544 383.213ZM331.843 378.66V378.387C331.843 378.109 331.916 377.885 332.062 377.717C332.207 377.548 332.447 377.441 332.779 377.396C333.007 377.364 333.162 377.316 333.244 377.252C333.326 377.184 333.367 377.065 333.367 376.896C333.367 376.737 333.306 376.621 333.183 376.548C333.064 376.475 332.896 376.438 332.677 376.438C332.412 376.438 332.148 376.477 331.884 376.555C331.624 376.632 331.469 376.689 331.419 376.726L331.002 375.775C331.171 375.689 331.437 375.598 331.802 375.502C332.166 375.406 332.542 375.358 332.93 375.358C333.499 375.358 333.932 375.491 334.229 375.755C334.525 376.019 334.673 376.377 334.673 376.828C334.673 377.298 334.52 377.671 334.215 377.949C333.914 378.227 333.44 378.391 332.793 378.441V378.66H331.843ZM337.024 384.881C337.024 384.097 337.327 383.505 337.934 383.104C338.544 382.698 339.312 382.495 340.237 382.495H341.707V382.058C341.707 381.702 341.614 381.413 341.427 381.189C341.244 380.962 340.921 380.848 340.456 380.848C339.991 380.848 339.661 380.941 339.465 381.128C339.273 381.315 339.178 381.536 339.178 381.791V381.873H337.421V381.791C337.421 381.171 337.706 380.649 338.275 380.226C338.845 379.802 339.595 379.59 340.524 379.59C341.454 379.59 342.179 379.795 342.698 380.205C343.222 380.611 343.484 381.23 343.484 382.064V385.373C343.484 385.669 343.509 385.95 343.56 386.214C343.61 386.474 343.678 386.699 343.765 386.891V387H342.028C341.969 386.891 341.917 386.749 341.871 386.576C341.826 386.403 341.796 386.232 341.782 386.063C341.632 386.341 341.363 386.59 340.976 386.809C340.588 387.027 340.098 387.137 339.506 387.137C338.809 387.137 338.221 386.948 337.742 386.569C337.264 386.187 337.024 385.624 337.024 384.881ZM338.809 384.737C338.809 385.084 338.909 385.362 339.109 385.571C339.31 385.776 339.627 385.879 340.06 385.879C340.511 385.879 340.898 385.731 341.222 385.435C341.545 385.138 341.707 384.799 341.707 384.416V383.616H340.47C339.914 383.616 339.497 383.714 339.219 383.91C338.945 384.106 338.809 384.382 338.809 384.737Z"
					fill="white"
					variants={draw}
				/>
			</motion.svg>
		</>
	)
}

export { FiveElementsDiagram }

interface CircleGradientTracingProps {
	cx: number
	cy: number
	r: number
	strokeWidth?: number
	baseColor?: string
	gradientColors?: [string, string, string]
	duration?: number
}

const CircleGradientTracing: React.FC<CircleGradientTracingProps> = ({
	cx,
	cy,
	r,
	strokeWidth = 2,
	gradientColors = ['#a3e635', '#fb7185', '#22d3ee'],
	duration = 3,
}) => {
	const { theme } = useTheme()
	const id = `circle-grad-${Math.random().toString(36).slice(2, 9)}`
	const path = `M ${cx + r} ${cy}
    A ${r} ${r} 0 1 1 ${cx - r} ${cy}
    A ${r} ${r} 0 1 1 ${cx + r} ${cy}`

	return (
		<>
			<path d={path} stroke={`url(#${id})`} strokeWidth={strokeWidth} fill="none" />

			<motion.circle
				cx="213"
				cy="225"
				r="199.5"
				stroke={theme === 'dark' ? '#43434378' : '#3D3D3D78'}
				variants={draw}
			/>

			<defs>
				<motion.radialGradient
					id={id}
					gradientUnits="userSpaceOnUse"
					cx={cx + r}
					cy={cy}
					r={r}
					animate={{
						gradientTransform: [`rotate(0 ${cx} ${cy})`, `rotate(360 ${cx} ${cy})`],
					}}
					transition={{
						duration,
						repeat: Infinity,
						ease: 'linear',
					}}
				>
					<stop offset="0" stopColor={gradientColors[1]} stopOpacity="1" />
					<stop offset="0.3" stopColor={gradientColors[1]} stopOpacity="0.6" />
					<stop offset="1" stopColor={gradientColors[2]} stopOpacity="0" />
				</motion.radialGradient>
			</defs>
		</>
	)
}
